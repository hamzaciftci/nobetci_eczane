services:
  api:
    image: ${API_IMAGE}
    restart: always
    environment:
      NODE_ENV: production
      API_HOST: 0.0.0.0
      API_PORT: 4000
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      CORS_ORIGIN: ${CORS_ORIGIN}
      ADMIN_API_TOKEN: ${ADMIN_API_TOKEN}
      INGESTION_QUEUE_NAME: ${INGESTION_QUEUE_NAME:-ingestion}
    ports:
      - "4000:4000"

  worker:
    image: ${WORKER_IMAGE}
    restart: always
    environment:
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      PROVINCE_SLUGS: ${PROVINCE_SLUGS}
      INGESTION_QUEUE_NAME: ${INGESTION_QUEUE_NAME:-ingestion}
      ALLOW_STATIC_FALLBACK: ${ALLOW_STATIC_FALLBACK:-1}
      ALLOW_FALLBACK_FOR_SECONDARY: ${ALLOW_FALLBACK_FOR_SECONDARY:-0}
